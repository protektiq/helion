{"openapi":"3.1.0","info":{"title":"Helion API","version":"0.1.0"},"paths":{"/api/v1/health/":{"get":{"tags":["health"],"summary":"Get Health","description":"Return service health status and database connectivity.\nUsed by load balancers and monitoring.","operationId":"get_health_api_v1_health__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"}}}}}}},"/api/v1/auth":{"post":{"tags":["auth"],"summary":"Login","description":"Authenticate with username and password; returns a JWT access token.\nInclude the token in the Authorization header as: Bearer <access_token>","operationId":"login_api_v1_auth_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/users":{"get":{"tags":["auth"],"summary":"List Users","description":"List all users (admin only). Demonstrates RBAC.","operationId":"list_users_api_v1_auth_users_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UsersListResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/upload":{"post":{"tags":["upload"],"summary":"Upload Findings","description":"Accept SAST/SCA findings as JSON and persist them. Requires authentication.\n\n- **JSON body**: Send `Content-Type: application/json` with either a single\n  finding object or an array of finding objects.\n- **File upload**: Send `Content-Type: multipart/form-data` with a field\n  named `file` containing a `.json` file with the same structure.\n\nFindings are validated with the raw finding schema, normalized, and stored\nin the database. Returns the count of accepted findings and their IDs.","operationId":"upload_findings_api_v1_upload_post","responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UploadResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/clusters":{"get":{"tags":["clusters"],"summary":"Get Clusters","description":"Return distinct vulnerability clusters plus compression metrics.\n\nClusters and metrics are from current DB findings only. SCA grouped by CVE ID,\nSAST by rule ID + file path pattern.","operationId":"get_clusters_api_v1_clusters_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClustersResponse"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/reasoning":{"post":{"tags":["reasoning"],"summary":"Post Reasoning","description":"Run reasoning on vulnerability clusters via the local LLM (Ollama / Llama 3).\n\nSend a list of clusters in the request body, or set use_db=true to use current\nclusters from the database (same as GET /clusters). Returns a summary and\nper-cluster notes (priority and reasoning from the LLM). Assigned risk tiers\n(Tier 1/2/3) are computed deterministically by override rules (e.g. CVSS > 9\n→ Tier 1 unless dev-only); final tier is AI-assisted, not AI-dependent.","operationId":"post_reasoning_api_v1_reasoning_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReasoningRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReasoningResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/exploitability":{"post":{"tags":["exploitability"],"summary":"Post Exploitability","description":"Run exploitability reasoning for a single vulnerability.\n\nSends vulnerability summary, CVSS score, repo context, dependency type, and\nexposure flags to the local LLM (Ollama). Returns adjusted_risk_tier,\nreasoning, and recommended_action as structured JSON.","operationId":"post_exploitability_api_v1_exploitability_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExploitabilityRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExploitabilityOutput"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/tickets":{"post":{"tags":["tickets"],"summary":"Post Tickets","description":"Convert vulnerability clusters into Jira-ready ticket payloads.\n\nSend clusters in the request body, or set use_db=true to use current clusters\nfrom the database. Optionally set use_reasoning=true to run the reasoning\nservice and risk tier assignment and attach remediation and tier to each ticket.\n\nReturns one ticket payload per cluster with title, description, affected\nservices, acceptance criteria, recommended remediation, and risk tier label.","operationId":"post_tickets_api_v1_tickets_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TicketsRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TicketsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/jira/export":{"post":{"tags":["jira"],"summary":"Post Jira Export","description":"One-click export: create Jira epics (one per risk tier) and issues under them.\n\nUses the same request as POST /tickets: clusters, use_db, use_reasoning.\nWith use_db=true and use_reasoning=true, exports current DB clusters with\nreasoning and risk tiers. Requires JIRA_BASE_URL, JIRA_EMAIL, JIRA_API_TOKEN,\nJIRA_PROJECT_KEY to be set.","operationId":"post_jira_export_api_v1_jira_export_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TicketsRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JiraExportResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/":{"get":{"summary":"Root","description":"Root route; minimal payload for discovery.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"string"},"type":"object","title":"Response Root  Get"}}}}}}}},"components":{"schemas":{"ClusterNote":{"properties":{"vulnerability_id":{"type":"string","minLength":1,"title":"Vulnerability Id","description":"Canonical identifier of the cluster (e.g. CVE, rule ID)."},"priority":{"type":"string","minLength":1,"title":"Priority","description":"Suggested priority label from LLM (e.g. high, medium, low, critical)."},"reasoning":{"type":"string","title":"Reasoning","description":"Short explanation or remediation hint for this cluster from the LLM."},"assigned_tier":{"anyOf":[{"type":"integer","enum":[1,2,3]},{"type":"null"}],"title":"Assigned Tier","description":"Final risk tier (1=highest, 3=lowest) from deterministic override rules; set when tier assignment runs."},"override_applied":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Override Applied","description":"Override rule that applied (e.g. cvss_high, dev_only_downgrade), or None."}},"type":"object","required":["vulnerability_id","priority","reasoning"],"title":"ClusterNote","description":"Per-cluster note: LLM priority and reasoning, plus optional deterministic tier assignment."},"ClustersResponse":{"properties":{"clusters":{"items":{"$ref":"#/components/schemas/VulnerabilityCluster"},"type":"array","title":"Clusters","description":"Distinct vulnerability clusters (SCA by CVE+dependency, SAST by rule+path)."},"metrics":{"$ref":"#/components/schemas/CompressionMetrics","description":"Compression metrics: raw_finding_count, cluster_count, compression_ratio."}},"type":"object","required":["clusters","metrics"],"title":"ClustersResponse","description":"Response for GET /api/v1/clusters: clusters plus compression metrics."},"CompressionMetrics":{"properties":{"raw_finding_count":{"type":"integer","minimum":0.0,"title":"Raw Finding Count","description":"Total number of findings (DB rows) before clustering."},"cluster_count":{"type":"integer","minimum":0.0,"title":"Cluster Count","description":"Number of distinct vulnerability clusters."},"compression_ratio":{"type":"number","minimum":0.0,"title":"Compression Ratio","description":"Raw findings per cluster (raw_finding_count / cluster_count); 0 when cluster_count is 0."}},"type":"object","required":["raw_finding_count","cluster_count","compression_ratio"],"title":"CompressionMetrics","description":"Metrics for clustering compression: raw finding count vs cluster count."},"DevTicketPayload":{"properties":{"title":{"type":"string","maxLength":255,"minLength":1,"title":"Title","description":"Short ticket title (e.g. [Tier N] CVE-XXX)."},"description":{"type":"string","maxLength":32000,"minLength":1,"title":"Description","description":"Structured description: vulnerability_id, description, severity, CVSS, context."},"affected_services":{"items":{"type":"string"},"type":"array","maxItems":100,"minItems":1,"title":"Affected Services","description":"List of affected repositories/services."},"acceptance_criteria":{"items":{"type":"string"},"type":"array","maxItems":20,"minItems":1,"title":"Acceptance Criteria","description":"List of acceptance criteria for the ticket."},"recommended_remediation":{"type":"string","maxLength":2000,"minLength":1,"title":"Recommended Remediation","description":"Recommended remediation (from LLM or cluster description)."},"risk_tier_label":{"type":"string","maxLength":32,"minLength":1,"title":"Risk Tier Label","description":"Human-readable risk tier (e.g. Tier 1, Tier 2, Tier 3)."}},"type":"object","required":["title","description","affected_services","acceptance_criteria","recommended_remediation","risk_tier_label"],"title":"DevTicketPayload","description":"Jira-ready ticket payload for one vulnerability cluster.\n\nSuitable for manual ticket creation or downstream Jira API integration."},"ExploitabilityOutput":{"properties":{"adjusted_risk_tier":{"type":"string","enum":["critical","high","medium","low","info"],"title":"Adjusted Risk Tier","description":"Risk tier after considering exploitability and context."},"reasoning":{"type":"string","maxLength":500,"minLength":1,"title":"Reasoning","description":"1-3 sentences explaining the adjusted tier."},"recommended_action":{"type":"string","maxLength":300,"minLength":1,"title":"Recommended Action","description":"One concrete action (e.g. patch, isolate, accept risk)."}},"type":"object","required":["adjusted_risk_tier","reasoning","recommended_action"],"title":"ExploitabilityOutput","description":"Structured output from exploitability reasoning: adjusted risk and recommended action."},"ExploitabilityRequest":{"properties":{"vulnerability_summary":{"type":"string","maxLength":2000,"minLength":1,"title":"Vulnerability Summary","description":"Short summary or description of the vulnerability."},"cvss_score":{"type":"number","maximum":10.0,"minimum":0.0,"title":"Cvss Score","description":"CVSS score in range 0.0–10.0."},"repo_context":{"type":"string","maxLength":500,"title":"Repo Context","description":"Repository or service context (e.g. name, path, role).","default":""},"dependency_type":{"type":"string","maxLength":100,"title":"Dependency Type","description":"Type of dependency if applicable (e.g. direct, transitive, dev, n/a).","default":""},"exposure_flags":{"type":"string","maxLength":300,"title":"Exposure Flags","description":"Exposure context (e.g. internet-facing, no-auth, internal-only).","default":""}},"type":"object","required":["vulnerability_summary","cvss_score"],"title":"ExploitabilityRequest","description":"Request body for POST /api/v1/exploitability."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthResponse":{"properties":{"status":{"type":"string","const":"ok","title":"Status","description":"Service status","default":"ok"},"environment":{"type":"string","title":"Environment","description":"Current app environment (e.g. dev, prod)"},"database":{"anyOf":[{"type":"string","enum":["connected","disconnected"]},{"type":"null"}],"title":"Database","description":"Database connectivity status when check is performed"}},"type":"object","required":["environment"],"title":"HealthResponse","description":"Response body for the health check endpoint."},"JiraCreatedIssue":{"properties":{"title":{"type":"string","title":"Title","description":"Issue summary/title."},"key":{"type":"string","minLength":1,"title":"Key","description":"Jira issue key (e.g. PROJ-123)."},"tier":{"type":"string","minLength":1,"title":"Tier","description":"Risk tier label (e.g. Tier 1)."}},"type":"object","required":["title","key","tier"],"title":"JiraCreatedIssue","description":"One created Jira issue returned from export."},"JiraExportResponse":{"properties":{"epics":{"additionalProperties":{"type":"string"},"type":"object","title":"Epics","description":"Risk tier label → Jira epic issue key."},"issues":{"items":{"$ref":"#/components/schemas/JiraCreatedIssue"},"type":"array","title":"Issues","description":"Created Jira issues, one per ticket."},"errors":{"items":{"type":"string"},"type":"array","title":"Errors","description":"Per-issue or global error messages (partial success)."}},"type":"object","title":"JiraExportResponse","description":"Response for POST /api/v1/jira/export."},"LoginRequest":{"properties":{"username":{"type":"string","maxLength":255,"minLength":1,"title":"Username","description":"Username"},"password":{"type":"string","maxLength":128,"minLength":8,"title":"Password","description":"Password"}},"type":"object","required":["username","password"],"title":"LoginRequest","description":"Credentials for login."},"ReasoningRequest":{"properties":{"clusters":{"items":{"$ref":"#/components/schemas/VulnerabilityCluster"},"type":"array","maxItems":100,"minItems":0,"title":"Clusters","description":"Vulnerability clusters to send to the LLM for reasoning."},"use_db":{"type":"boolean","title":"Use Db","description":"If true, ignore clusters in body and load current clusters from DB.","default":false}},"type":"object","required":["clusters"],"title":"ReasoningRequest","description":"Request body for POST /api/v1/reasoning."},"ReasoningResponse":{"properties":{"summary":{"type":"string","title":"Summary","description":"Short overall assessment of the vulnerability clusters."},"cluster_notes":{"items":{"$ref":"#/components/schemas/ClusterNote"},"type":"array","title":"Cluster Notes","description":"One entry per cluster (or notable clusters) with priority and reasoning."}},"type":"object","required":["summary","cluster_notes"],"title":"ReasoningResponse","description":"Structured response from the reasoning service (LLM output)."},"TicketsRequest":{"properties":{"clusters":{"items":{"$ref":"#/components/schemas/VulnerabilityCluster"},"type":"array","maxItems":100,"title":"Clusters","description":"Clusters to convert to tickets; ignored when use_db is true."},"use_db":{"type":"boolean","title":"Use Db","description":"If true, load current clusters from the database (same as GET /clusters).","default":false},"use_reasoning":{"type":"boolean","title":"Use Reasoning","description":"If true, run reasoning and risk tier assignment and attach to each ticket.","default":false},"tier_overrides":{"anyOf":[{"additionalProperties":{"type":"string"},"type":"object"},{"type":"null"}],"title":"Tier Overrides","description":"Optional consultant override: vulnerability_id -> Tier 1 | Tier 2 | Tier 3."}},"type":"object","title":"TicketsRequest","description":"Request body for POST /api/v1/tickets."},"TicketsResponse":{"properties":{"tickets":{"items":{"$ref":"#/components/schemas/DevTicketPayload"},"type":"array","title":"Tickets","description":"Jira-ready ticket payloads, one per cluster."}},"type":"object","required":["tickets"],"title":"TicketsResponse","description":"Response for POST /api/v1/tickets."},"TokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token","description":"JWT access token"},"token_type":{"type":"string","title":"Token Type","description":"Token type","default":"bearer"}},"type":"object","required":["access_token"],"title":"TokenResponse","description":"JWT access token returned after successful login."},"UploadResponse":{"properties":{"accepted":{"type":"integer","minimum":0.0,"title":"Accepted","description":"Number of findings accepted and persisted."},"ids":{"items":{"type":"integer"},"type":"array","title":"Ids","description":"Database IDs of the created finding rows."}},"type":"object","required":["accepted"],"title":"UploadResponse","description":"Response after successfully persisting findings."},"UserListItem":{"properties":{"id":{"type":"integer","title":"Id"},"username":{"type":"string","title":"Username"},"role":{"type":"string","title":"Role"}},"type":"object","required":["id","username","role"],"title":"UserListItem","description":"User entry for admin list (no password)."},"UsersListResponse":{"properties":{"users":{"items":{"$ref":"#/components/schemas/UserListItem"},"type":"array","title":"Users"}},"type":"object","required":["users"],"title":"UsersListResponse","description":"Response for GET /users (admin only)."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"VulnerabilityCluster":{"properties":{"vulnerability_id":{"type":"string","minLength":1,"title":"Vulnerability Id","description":"Canonical identifier for the vulnerability (e.g. CVE, GHSA)."},"severity":{"type":"string","enum":["critical","high","medium","low","info"],"title":"Severity","description":"Canonical severity for the cluster."},"repo":{"type":"string","minLength":1,"title":"Repo","description":"Single repository when affected_services_count is 1; 'multiple' when the cluster spans more than one repo."},"file_path":{"type":"string","title":"File Path","description":"Primary or canonical file path for this cluster; empty if not file-specific.","default":""},"dependency":{"type":"string","title":"Dependency","description":"Affected dependency; empty if not dependency-related.","default":""},"cvss_score":{"type":"number","maximum":10.0,"minimum":0.0,"title":"Cvss Score","description":"Canonical CVSS score in range 0.0–10.0."},"description":{"type":"string","minLength":1,"title":"Description","description":"Canonical description of the vulnerability."},"finding_ids":{"items":{"type":"string"},"type":"array","minItems":1,"title":"Finding Ids","description":"IDs of normalized findings that belong to this cluster."},"affected_services_count":{"type":"integer","minimum":1.0,"title":"Affected Services Count","description":"Count of distinct repositories (services) affected by this cluster."},"finding_count":{"type":"integer","minimum":1.0,"title":"Finding Count","description":"Number of findings in this cluster (len(finding_ids))."}},"type":"object","required":["vulnerability_id","severity","repo","cvss_score","description","finding_ids","affected_services_count","finding_count"],"title":"VulnerabilityCluster","description":"One logical vulnerability (e.g. one CVE) that may appear in multiple repos/files, with canonical fields and references to normalized findings."}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}