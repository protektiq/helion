(()=>{var e={};e.id=988,e.ids=[988],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9067:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(7148),r(9935),r(5866);var s=r(3191),i=r(8716),n=r(7922),l=r.n(n),a=r(5231),o={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>a[e]);r.d(t,o);let d=["",{children:["tickets",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7148)),"/home/carlos/helion/web/app/tickets/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9935)),"/home/carlos/helion/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/carlos/helion/web/app/tickets/page.tsx"],u="/tickets/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/tickets/page",pathname:"/tickets",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8932:(e,t,r)=>{Promise.resolve().then(r.bind(r,1901))},7327:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var s=r(326);let i={marginBottom:"1rem",color:"#b91c1c"};function n({message:e,onRetry:t,retryLabel:r}){return(0,s.jsxs)("div",{role:"alert",style:i,children:[s.jsx("p",{style:{margin:0},children:e}),"function"==typeof t&&s.jsx("button",{type:"button",onClick:t,"aria-label":r??"Retry",style:{marginTop:"0.5rem"},children:"Retry"})]})}},1901:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(326),i=r(7577),n=r(2809),l=r(565),a=r(7277),o=r(7327);let d=["Tier 1","Tier 2","Tier 3"];function c(){let[e,t]=(0,i.useState)(!0),[r,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(null),[p,g]=(0,i.useState)(!1),[h,y]=(0,i.useState)("idle"),[f,b]=(0,i.useState)(null),[x,v]=(0,i.useState)(null),[j,_]=(0,i.useState)(null),[k,S]=(0,i.useState)("idle"),[C,w]=(0,i.useState)(""),[P,B]=(0,i.useState)(null),[A,R]=(0,i.useState)(null),[T,N]=(0,i.useState)({}),[O,z]=(0,i.useState)(null),[J,q]=(0,i.useState)(null),I=(0,i.useMemo)(()=>e&&j?.clusters?.length?j.clusters:!e&&P?.length?P:[],[e,j?.clusters,P]);(0,i.useCallback)(async()=>{S("loading");try{let e=(0,n.Um)(),t=await e.getClusters();_(t),S("success")}catch{S("error")}},[]);let W=(0,i.useCallback)(e=>{t(e.target.checked)},[]),G=(0,i.useCallback)(e=>{c(e.target.checked)},[]),U=(0,i.useCallback)(e=>{g(e.target.checked)},[]),E=(0,i.useCallback)(()=>{(0,a.sg)(),m(null),g(!1)},[]),$=(0,i.useCallback)(e=>{let t=e.target.value;if(w(t),0===t.trim().length){B(null),R(null);return}let[r,s]=(0,l.Y)(t);B(r),R(s)},[]),M=(0,i.useCallback)((e,t)=>{N(r=>{if(""===t||!d.includes(t)){let t={...r};return delete t[e],t}return{...r,[e]:t}})},[]),Y=(0,i.useCallback)(()=>{if(null===O)return;let e=JSON.stringify(O,null,2);navigator.clipboard.writeText(e).then(()=>{q("Copied to clipboard"),setTimeout(()=>q(null),2e3)},()=>q("Copy failed"))},[O]),D=(0,i.useCallback)(async t=>{t.preventDefault();let s=null;if(!e){let e=C.trim();if(0===e.length){R("Paste clusters JSON when not using database.");return}let[t,r]=(0,l.Y)(e);if(null!==r||null===t||0===t.length){R(r??"No clusters in pasted JSON.");return}B(t),R(null),s=t}y("submitting"),b(null),v(null);try{let t=p&&null!==u,i={use_db:e,use_reasoning:!t&&r,...t&&u?{reasoning_response:u}:{},...!e&&s&&s.length>0?{clusters:s}:{},...Object.keys(T).length>0?{tier_overrides:T}:{}},l=(0,n.Um)(),a=await l.postTickets(i);z(i),b(a),y("success")}catch(e){v((0,n.e$)(e)),y("error")}},[e,r,p,u,C,T]);return(0,s.jsxs)("main",{style:{padding:"2rem",maxWidth:"56rem",margin:"0 auto"},children:[s.jsx("h1",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Tickets preview"}),null!==u&&(0,s.jsxs)("div",{style:{marginBottom:"1rem",padding:"0.75rem 1rem",backgroundColor:"#ecfdf5",border:"1px solid #a7f3d0",borderRadius:"4px"},role:"status","aria-live":"polite",children:[s.jsx("span",{children:"Using reasoning notes from the Reasoning page."}),s.jsx("button",{type:"button",onClick:E,style:{marginLeft:"0.75rem",padding:"0.25rem 0.5rem",fontSize:"0.875rem"},"aria-label":"Clear stored reasoning notes",children:"Clear stored notes"})]}),(0,s.jsxs)("form",{onSubmit:D,style:{marginBottom:"1.5rem"},children:[(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[s.jsx("input",{type:"checkbox",checked:e,onChange:W,"aria-label":"Use current clusters from database","aria-checked":e}),s.jsx("span",{children:"Use current clusters from database"})]}),null!==u?(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[s.jsx("input",{type:"checkbox",checked:p,onChange:U,"aria-label":"Use stored reasoning notes from Reasoning page","aria-checked":p}),s.jsx("span",{children:"Use stored reasoning notes"})]}):null,(!u||!p)&&(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem"},children:[s.jsx("input",{type:"checkbox",checked:r,onChange:G,"aria-label":"Run reasoning and attach to tickets","aria-checked":r}),s.jsx("span",{children:"Run reasoning and attach to tickets"})]}),!e&&(0,s.jsxs)("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{htmlFor:"tickets-paste-clusters",style:{display:"block",marginBottom:"0.25rem",fontWeight:500},children:"Paste clusters JSON"}),s.jsx("textarea",{id:"tickets-paste-clusters",value:C,onChange:$,placeholder:"Paste ClustersResponse.clusters JSON or full ClustersResponse object",rows:6,style:{width:"100%",padding:"0.5rem 0.75rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #e5e7eb",borderRadius:"4px"},"aria-describedby":A?"tickets-clusters-parse-error":void 0,"aria-invalid":null!==A}),null!==A&&s.jsx("p",{id:"tickets-clusters-parse-error",role:"alert",style:{marginTop:"0.25rem",color:"#b91c1c",fontSize:"0.875rem"},children:A})]}),I.length>0&&s.jsx("div",{style:{marginBottom:"1rem"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #e5e7eb"},"aria-label":"Tier overrides per vulnerability",children:[s.jsx("caption",{style:{textAlign:"left",marginBottom:"0.5rem",fontWeight:500},children:"Tier overrides (optional)"}),s.jsx("thead",{children:(0,s.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[s.jsx("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"Vulnerability ID"}),s.jsx("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"Tier override"})]})}),s.jsx("tbody",{children:I.map(e=>(0,s.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[s.jsx("td",{style:{padding:"0.5rem 0.75rem",fontSize:"0.875rem"},children:e.vulnerability_id}),s.jsx("td",{style:{padding:"0.5rem 0.75rem"},children:(0,s.jsxs)("select",{value:T[e.vulnerability_id]??"",onChange:t=>M(e.vulnerability_id,t.target.value),"aria-label":`Tier override for ${e.vulnerability_id}`,style:{padding:"0.25rem 0.5rem",fontSize:"0.875rem",minWidth:"8rem"},children:[s.jsx("option",{value:"",children:"No override"}),d.map(e=>s.jsx("option",{value:e,children:e},e))]})})]},e.vulnerability_id))})]})}),s.jsx("button",{type:"submit",disabled:"submitting"===h||e&&"loading"===k,"aria-busy":"submitting"===h,"aria-label":"submitting"===h?"Generating tickets":"Generate tickets",children:"submitting"===h?"Loadingâ€¦":"Generate tickets"})]}),"error"===h&&null!==x&&""!==x&&s.jsx(o.Z,{message:x}),"success"===h&&null!==f&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.75rem",flexWrap:"wrap"},children:[(0,s.jsxs)("h2",{style:{fontSize:"1rem",margin:0},children:["Tickets (",f.tickets.length,")"]}),s.jsx("button",{type:"button",onClick:Y,disabled:null===O,"aria-label":"Copy request payload as JSON",style:{padding:"0.25rem 0.5rem",fontSize:"0.875rem"},children:"Copy JSON"}),null!==J&&s.jsx("span",{role:"status","aria-live":"polite",style:{fontSize:"0.875rem",color:"#6b7280"},children:J})]}),s.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:f.tickets.map((e,t)=>(0,s.jsxs)("li",{style:{border:"1px solid #e5e7eb",borderRadius:"4px",padding:"1rem",marginBottom:"1rem"},children:[s.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem"},children:e.title}),s.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.5rem"},children:e.risk_tier_label}),(0,s.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[s.jsx("strong",{children:"Affected services:"})," ",e.affected_services.join(", ")]}),(0,s.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[s.jsx("strong",{children:"Recommended remediation:"})," ",e.recommended_remediation]}),(0,s.jsxs)("div",{children:[s.jsx("strong",{children:"Acceptance criteria:"}),s.jsx("ul",{style:{margin:"0.25rem 0 0 1rem",padding:0},children:e.acceptance_criteria.map((e,t)=>s.jsx("li",{children:e},t))})]}),s.jsx("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-wrap",fontSize:"0.875rem",color:"#6b7280"},children:e.description})]},t))})]})]})}},565:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n,g:()=>s});let s=100,i=["critical","high","medium","low","info"];function n(e){let t,r;let n=e.trim();if(0===n.length)return[null,"Paste JSON (ClustersResponse or clusters array)."];try{t=JSON.parse(n)}catch{return[null,"Invalid JSON. Paste ClustersResponse.clusters or an array of clusters."]}if(Array.isArray(t))r=t;else{if(!(null!==t&&"object"==typeof t&&"clusters"in t&&Array.isArray(t.clusters)))return[null,"Expected a ClustersResponse object (with clusters array) or a raw clusters array."];r=t.clusters}if(r.length>s)return[null,`At most ${s} clusters are allowed.`];let l=[];for(let e=0;e<r.length;e++){var a;let t=r[e];if(null===t||"object"!=typeof t)return[null,`Cluster at index ${e}: must be an object.`];let s="string"==typeof t.vulnerability_id?t.vulnerability_id:void 0,n="string"==typeof t.severity&&(a=t.severity,i.includes(a))?t.severity:void 0,o="string"==typeof t.repo?t.repo:void 0,d="number"==typeof t.cvss_score&&t.cvss_score>=0&&t.cvss_score<=10?t.cvss_score:void 0,c="string"==typeof t.description?t.description:void 0,u=Array.isArray(t.finding_ids)&&t.finding_ids.every(e=>"string"==typeof e)?t.finding_ids:void 0,m="number"==typeof t.affected_services_count&&t.affected_services_count>=0?t.affected_services_count:void 0,p="number"==typeof t.finding_count&&t.finding_count>=0?t.finding_count:void 0;if(void 0===s||void 0===n||void 0===o||void 0===d||void 0===c||void 0===u||void 0===m||void 0===p)return[null,`Cluster at index ${e}: missing or invalid required fields (vulnerability_id, severity, repo, cvss_score, description, finding_ids, affected_services_count, finding_count).`];l.push({vulnerability_id:s,severity:n,repo:o,file_path:"string"==typeof t.file_path?t.file_path:void 0,dependency:"string"==typeof t.dependency?t.dependency:void 0,cvss_score:d,description:c,finding_ids:u,affected_services_count:m,finding_count:p})}return[l,null]}},7277:(e,t,r)=>{"use strict";r.d(t,{ds:()=>i,sg:()=>n});let s="helion_reasoning_response";function i(e){if("undefined"!=typeof sessionStorage)try{let t=JSON.stringify(e);if(t.length>5e5)return;sessionStorage.setItem(s,t)}catch{}}function n(){if("undefined"!=typeof sessionStorage)try{sessionStorage.removeItem(s)}catch{}}},7148:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`/home/carlos/helion/web/app/tickets/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[991,636],()=>r(9067));module.exports=s})();