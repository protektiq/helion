(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87],{6010:function(e,t,r){Promise.resolve().then(r.bind(r,4086))},4086:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var i=r(7437),n=r(2265),l=r(7648),o=r(9116);let s=["critical","high","medium","low","info"],a=["Tier 1","Tier 2","Tier 3"];function c(e){let t=String(null!=e?e:"").toLowerCase().trim();return"critical"===t?"Tier 1":"high"===t?"Tier 2":"Tier 3"}function u(){let[e,t]=(0,n.useState)(null),[r,u]=(0,n.useState)("idle"),[d,m]=(0,n.useState)(null),[h,p]=(0,n.useState)("idle"),[f,y]=(0,n.useState)(null),[g,x]=(0,n.useState)(!1),[b,v]=(0,n.useState)({}),j=(0,n.useCallback)(async()=>{let e=(0,o.bR)();u("loading"),m(null);try{let i=await fetch("".concat(e,"/api/v1/clusters"),{headers:(0,o.g0)()});if(!i.ok){var r;let e=null!==(r=i.headers.get("content-type"))&&void 0!==r?r:"",t=i.statusText;if(e.includes("application/json"))try{let e=await i.json();Array.isArray(e.detail)?t=e.detail.map(e=>String(e)).join("; "):"string"==typeof e.detail&&(t=e.detail)}catch(e){}m(t),u("error");return}let n=await i.json();if(!function(e){if(null===e||"object"!=typeof e||!e.metrics||"object"!=typeof e.metrics)return!1;let t=e.metrics;if("number"!=typeof t.raw_finding_count||"number"!=typeof t.cluster_count||"number"!=typeof t.compression_ratio||!Array.isArray(e.clusters))return!1;for(let t of e.clusters)if("object"!=typeof t||null===t||"string"!=typeof t.severity||"string"!=typeof t.vulnerability_id||!t.vulnerability_id.trim())return!1;return!0}(n)){m("Invalid response shape from API."),u("error");return}t(n),u("success")}catch(e){m(e instanceof Error?e.message:"Network or request failed."),u("error")}},[]);(0,n.useEffect)(()=>{j()},[j]);let _=(0,n.useCallback)(()=>{x(t=>{var r;let i=!t;if(i&&(null==e?void 0:null===(r=e.clusters)||void 0===r?void 0:r.length)){let t={};for(let r of e.clusters)t[r.vulnerability_id]=c(r.severity);v(t)}return i})},[null==e?void 0:e.clusters]),T=(0,n.useCallback)((e,t)=>{("Tier 1"===t||"Tier 2"===t||"Tier 3"===t)&&v(r=>({...r,[e]:t}))},[]),w=(0,n.useCallback)(async()=>{let e=(0,o.bR)();p("exporting"),y(null);let t={use_db:!0,use_reasoning:!1};g&&Object.keys(b).length>0&&(t.tier_overrides=b);try{let r=await fetch("".concat(e,"/api/v1/jira/export"),{method:"POST",headers:{...(0,o.g0)(),"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await r.json().catch(()=>({})),n=Array.isArray(i.errors)?i.errors:[];if(!r.ok){let e=r.statusText;if(null!==i&&"object"==typeof i&&"detail"in i){let t=i.detail;"string"==typeof t?e=t:Array.isArray(t)&&(e=t.map(e=>String(e)).join("; "))}y(n.length>0?[...n,e].join(" "):e),p("error");return}let l=Array.isArray(i.issues)?i.issues.length:0,s=i.epics&&"object"==typeof i.epics?Object.keys(i.epics).length:0,a="Exported ".concat(l," issue(s) under ").concat(s," epic(s).");n.length>0&&(a+=" "+n.join(" ")),y(a),p("success")}catch(e){y(e instanceof Error?e.message:"Network or request failed."),p("error")}},[g,b]),A=null!==e?function(e){let t={critical:0,high:0,medium:0,low:0,info:0};for(let i of e){var r;let e=String(null!==(r=i.severity)&&void 0!==r?r:"").toLowerCase().trim();e in t&&(t[e]+=1)}return t}(e.clusters):null;return(0,i.jsxs)("main",{style:{padding:"2rem",maxWidth:"40rem",margin:"0 auto"},children:[(0,i.jsx)("h1",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Results summary"}),(0,i.jsx)("nav",{style:{marginBottom:"1.5rem"},children:(0,i.jsx)(l.default,{href:"/upload",style:{color:"#2563eb",textDecoration:"underline"},"aria-label":"Go to upload page",children:"Upload"})}),"loading"===r&&(0,i.jsx)("p",{role:"status","aria-live":"polite",children:"Loading summary…"}),"error"===r&&null!==d&&(0,i.jsxs)("div",{role:"alert",style:{marginBottom:"1rem",color:"#b91c1c"},children:[(0,i.jsx)("p",{children:d}),(0,i.jsx)("button",{type:"button",onClick:j,"aria-label":"Retry loading summary",children:"Retry"})]}),"success"===r&&null!==e&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"1.5rem"},"aria-label":"Results summary",children:[(0,i.jsx)("caption",{style:{textAlign:"left",marginBottom:"0.5rem"},children:"Summary of findings and clusters"}),(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb"},children:"Metric"}),(0,i.jsx)("th",{scope:"col",style:{textAlign:"right",padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb"},children:"Count"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb"},children:"Raw findings count"}),(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb",textAlign:"right"},children:e.metrics.raw_finding_count})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb"},children:"Cluster count"}),(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb",textAlign:"right"},children:e.metrics.cluster_count})]}),null!==A&&s.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb"},children:["Risk tier (",e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,")"]}),(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem",borderBottom:"1px solid #e5e7eb",textAlign:"right"},children:A[e]})]},e))]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:g?"0.75rem":0},children:[(0,i.jsx)("input",{type:"checkbox",checked:g,onChange:_,"aria-label":"Override tiers before export","aria-checked":g}),(0,i.jsx)("span",{children:"Override tiers before export"})]}),g&&e.clusters.length>0&&(0,i.jsx)("div",{style:{marginBottom:"1rem",border:"1px solid #e5e7eb",borderRadius:"4px",overflow:"hidden",maxHeight:"16rem",overflowY:"auto"},role:"region","aria-label":"Per-cluster tier override",children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},"aria-label":"Cluster tier overrides",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb",backgroundColor:"#f9fafb"},children:[(0,i.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem"},children:"Cluster"}),(0,i.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem"},children:"Tier"})]})}),(0,i.jsx)("tbody",{children:e.clusters.map(e=>{var t;let r=null!==(t=b[e.vulnerability_id])&&void 0!==t?t:c(e.severity),n=e.vulnerability_id.length>48?e.vulnerability_id.slice(0,45)+"...":e.vulnerability_id;return(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem"},title:e.vulnerability_id,children:n}),(0,i.jsx)("td",{style:{padding:"0.5rem 0.75rem"},children:(0,i.jsx)("select",{value:r,onChange:t=>T(e.vulnerability_id,t.target.value),"aria-label":"Tier for ".concat(e.vulnerability_id),style:{minWidth:"6rem"},children:a.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})})]},e.vulnerability_id)})})]})})]}),(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsx)("button",{type:"button",onClick:w,disabled:"exporting"===h,"aria-busy":"exporting"===h,"aria-label":"exporting"===h?"Exporting to Jira":"Export to Jira",children:"exporting"===h?"Exporting…":"Export to Jira"})}),(0,i.jsxs)("div",{role:"status","aria-live":"polite",style:{minHeight:"1.5em"},children:["success"===h&&null!==f&&(0,i.jsx)("p",{style:{color:"#166534"},children:f}),"error"===h&&null!==f&&(0,i.jsx)("p",{style:{color:"#b91c1c"},children:f})]})]}),"success"===r&&null===e&&(0,i.jsx)("p",{role:"status",children:"No summary data."})]})}},9116:function(e,t,r){"use strict";r.d(t,{bR:function(){return o},g0:function(){return s},nd:function(){return l}});var i=r(257);let n="http://localhost:8000",l="helion_access_token";function o(){if("string"!=typeof i.env.NEXT_PUBLIC_API_URL)return n;let e=i.env.NEXT_PUBLIC_API_URL.trim();return e.length>0?e.replace(/\/+$/,""):n}function s(){try{let e=localStorage.getItem(l),t="string"==typeof e?e.trim():"";if(0===t.length)return{};return{Authorization:"Bearer ".concat(t)}}catch(e){return{}}}},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var i=r(2972),n=r.n(i)},257:function(e,t,r){"use strict";var i,n;e.exports=(null==(i=r.g.process)?void 0:i.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,i,n=e.exports={};function l(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var a=[],c=!1,u=-1;function d(){c&&i&&(c=!1,i.length?a=i.concat(a):u=-1,a.length&&m())}function m(){if(!c){var e=s(d);c=!0;for(var t=a.length;t;){for(i=a,a=[];++u<t;)i&&i[u].run();u=-1,t=a.length}i=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new h(e,t)),1!==a.length||c||s(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var l=r[e]={exports:{}},o=!0;try{t[e](l,l.exports,i),o=!1}finally{o&&delete r[e]}return l.exports}i.ab="//";var n=i(229);e.exports=n}()}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=6010)}),_N_E=e.O()}]);