(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{3572:function(e,t,n){Promise.resolve().then(n.bind(n,1609))},1627:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(7437);let i={marginBottom:"1rem",color:"#b91c1c"};function o(e){let{message:t,onRetry:n,retryLabel:o}=e;return(0,r.jsxs)("div",{role:"alert",style:i,children:[(0,r.jsx)("p",{style:{margin:0},children:t}),"function"==typeof n&&(0,r.jsx)("button",{type:"button",onClick:n,"aria-label":null!=o?o:"Retry",style:{marginTop:"0.5rem"},children:"Retry"})]})}},1609:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(7437),i=n(2265),o=n(7648),s=n(2818),l=n(9579),a=n(5934),c=n(1627);function u(){let[e,t]=(0,i.useState)(!0),[n,u]=(0,i.useState)(""),[d,p]=(0,i.useState)("idle"),[f,y]=(0,i.useState)(null),[g,h]=(0,i.useState)(null),[m,v]=(0,i.useState)(!1),b=(0,i.useCallback)(e=>{t(e.target.checked)},[]),x=(0,i.useCallback)(e=>{u(e.target.value)},[]),_=(0,i.useCallback)(async t=>{if(t.preventDefault(),v(!1),!e){let[e,t]=(0,a.Y)(n);if(null!==t||null===e){h(null!=t?t:"Failed to parse clusters."),p("error"),y(null);return}p("submitting"),y(null),h(null);try{let t=(0,s.Um)(),n=await t.postReasoning({clusters:e,use_db:!1});y(n),p("success")}catch(e){h((0,s.e$)(e)),p("error")}return}p("submitting"),y(null),h(null);try{let e=(0,s.Um)(),t=await e.postReasoning({clusters:[],use_db:!0});y(t),p("success")}catch(e){h((0,s.e$)(e)),p("error")}},[e,n]),j=(0,i.useCallback)(()=>{null!==f&&((0,l.ds)(f),v(!0))},[f]);return(0,r.jsxs)("main",{style:{padding:"2rem",maxWidth:"48rem",margin:"0 auto"},children:[(0,r.jsx)("h1",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Reasoning"}),(0,r.jsxs)("form",{onSubmit:_,style:{marginBottom:"1.5rem"},children:[(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem"},children:[(0,r.jsx)("input",{type:"checkbox",checked:e,onChange:b,"aria-label":"Use current clusters from database","aria-checked":e}),(0,r.jsx)("span",{children:"Use current clusters from database"})]}),!e&&(0,r.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,r.jsx)("label",{htmlFor:"reasoning-clusters-json",style:{display:"block",marginBottom:"0.25rem"},children:"Paste clusters JSON"}),(0,r.jsx)("textarea",{id:"reasoning-clusters-json",value:n,onChange:x,placeholder:"Paste ClustersResponse.clusters JSON or full ClustersResponse object",rows:8,style:{width:"100%",padding:"0.5rem",fontFamily:"monospace",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"4px"},"aria-describedby":"reasoning-clusters-hint"}),(0,r.jsxs)("span",{id:"reasoning-clusters-hint",style:{fontSize:"0.75rem",color:"#6b7280"},children:['ClustersResponse with "clusters" array or raw array of clusters (max ',a.g,")."]})]}),(0,r.jsx)("button",{type:"submit",disabled:"submitting"===d,"aria-busy":"submitting"===d,"aria-label":"submitting"===d?"Running reasoning":"Run reasoning",children:"submitting"===d?"Running…":"Run reasoning"})]}),"error"===d&&null!==g&&""!==g&&(0,r.jsx)(c.Z,{message:g}),"success"===d&&null!==f&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:"Summary"}),(0,r.jsx)("p",{style:{marginBottom:"1rem",whiteSpace:"pre-wrap"},children:f.summary||"—"}),(0,r.jsx)("h2",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:"Cluster notes"}),(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #e5e7eb"},"aria-label":"Per-cluster notes: vulnerability id, priority, tier, override, reasoning",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,r.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"vulnerability_id"}),(0,r.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"priority"}),(0,r.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"assigned_tier"}),(0,r.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"override_applied"}),(0,r.jsx)("th",{scope:"col",style:{textAlign:"left",padding:"0.5rem 0.75rem",fontWeight:600},children:"reasoning"})]})}),(0,r.jsx)("tbody",{children:f.cluster_notes.map(e=>{var t;return(0,r.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,r.jsx)("td",{style:{padding:"0.5rem 0.75rem",verticalAlign:"top"},children:e.vulnerability_id}),(0,r.jsx)("td",{style:{padding:"0.5rem 0.75rem",verticalAlign:"top"},children:e.priority}),(0,r.jsx)("td",{style:{padding:"0.5rem 0.75rem",verticalAlign:"top"},children:null!=e.assigned_tier?e.assigned_tier:"—"}),(0,r.jsx)("td",{style:{padding:"0.5rem 0.75rem",verticalAlign:"top",color:"#6b7280"},children:null!==(t=e.override_applied)&&void 0!==t?t:"—"}),(0,r.jsx)("td",{style:{padding:"0.5rem 0.75rem",verticalAlign:"top",color:"#374151",whiteSpace:"pre-wrap"},children:e.reasoning})]},e.vulnerability_id)})})]}),(0,r.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,r.jsx)("button",{type:"button",onClick:j,"aria-label":"Store these notes for use on the Tickets page",children:"Use these notes for Tickets"}),m&&(0,r.jsxs)("span",{style:{marginLeft:"0.75rem",color:"#059669"},children:["Stored."," ",(0,r.jsx)(o.default,{href:"/tickets",style:{color:"#2563eb",textDecoration:"underline"},children:"Go to Tickets"})]})]})]})]})}},2818:function(e,t,n){"use strict";n.d(t,{Um:function(){return c},e$:function(){return l}});var r=n(6023),i=n(257);let o="http://localhost:8000",s=function(){if("string"!=typeof i.env.NEXT_PUBLIC_API_URL)return o;let e=i.env.NEXT_PUBLIC_API_URL.trim();return e.length>0?e.replace(/\/+$/,""):o};function l(e){return 401===(e&&"object"==typeof e&&"status"in e&&"number"==typeof e.status?e.status:void 0)?"Unauthorized. Please log in.":e instanceof Error?e.message:"Network or request failed."}async function a(e,t,n){var r,i;let o="".concat(e.replace(/\/+$/,"")).concat(t),s=function(e){let t={};return e.token&&e.token.length>0&&(t.Authorization="Bearer ".concat(e.token)),e.contentType&&(t["Content-Type"]=e.contentType),t}({token:n.token,contentType:null!==(r=n.contentType)&&void 0!==r?r:n.body instanceof FormData?void 0:"application/json"}),l={method:n.method,headers:s};void 0!==n.body&&(l.body=n.body);let a=await fetch(o,l);if(!a.ok){let e,t=a.statusText;if((null!==(i=a.headers.get("content-type"))&&void 0!==i?i:"").includes("application/json"))try{let n=await a.json();"detail"in n&&void 0!==n.detail&&(e=n.detail,"string"==typeof n.detail?t=n.detail:Array.isArray(n.detail)&&(t=n.detail.map(e=>e&&"object"==typeof e&&"msg"in e?e.msg:String(e)).join("; ")))}catch(e){}let n=Error(t);throw n.status=a.status,n.detail=e,n}return a.json()}function c(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=null!==(e=n.baseUrl)&&void 0!==e?e:s(),o=null!==(t=n.token)&&void 0!==t?t:(0,r.LP)();return{getHealth:()=>a(i,"/api/v1/health/",{method:"GET",token:o}),login:e=>a(i,"/api/v1/auth",{method:"POST",token:o,body:JSON.stringify(e),contentType:"application/json"}),listUsers:()=>a(i,"/api/v1/auth/users",{method:"GET",token:o}),uploadFindings(e){let t=e instanceof FormData;return a(i,"/api/v1/upload",{method:"POST",token:o,body:t?e:JSON.stringify(e),contentType:t?void 0:"application/json"})},getClusters:()=>a(i,"/api/v1/clusters",{method:"GET",token:o}),postReasoning:e=>a(i,"/api/v1/reasoning",{method:"POST",token:o,body:JSON.stringify(e),contentType:"application/json"}),postExploitability:e=>a(i,"/api/v1/exploitability",{method:"POST",token:o,body:JSON.stringify(e),contentType:"application/json"}),postTickets:e=>a(i,"/api/v1/tickets",{method:"POST",token:o,body:JSON.stringify(e),contentType:"application/json"}),postJiraExport:e=>a(i,"/api/v1/jira/export",{method:"POST",token:o,body:JSON.stringify(e),contentType:"application/json"})}}},6023:function(e,t,n){"use strict";n.d(t,{LP:function(){return i},o4:function(){return o},qz:function(){return s}});let r="helion_access_token";function i(){try{let e=localStorage.getItem(r),t="string"==typeof e?e.trim():"";return t.length>0?t:void 0}catch(e){return}}function o(e){if("string"!=typeof e)return;let t=e.trim();if(0!==t.length)try{let e=t.length>4096?t.slice(0,4096):t;localStorage.setItem(r,e)}catch(e){}}function s(){try{localStorage.removeItem(r)}catch(e){}}},5934:function(e,t,n){"use strict";n.d(t,{Y:function(){return o},g:function(){return r}});let r=100,i=["critical","high","medium","low","info"];function o(e){let t,n;let o=e.trim();if(0===o.length)return[null,"Paste JSON (ClustersResponse or clusters array)."];try{t=JSON.parse(o)}catch(e){return[null,"Invalid JSON. Paste ClustersResponse.clusters or an array of clusters."]}if(Array.isArray(t))n=t;else{if(!(null!==t&&"object"==typeof t&&"clusters"in t&&Array.isArray(t.clusters)))return[null,"Expected a ClustersResponse object (with clusters array) or a raw clusters array."];n=t.clusters}if(n.length>r)return[null,"At most ".concat(r," clusters are allowed.")];let s=[];for(let e=0;e<n.length;e++){var l;let t=n[e];if(null===t||"object"!=typeof t)return[null,"Cluster at index ".concat(e,": must be an object.")];let r="string"==typeof t.vulnerability_id?t.vulnerability_id:void 0,o="string"==typeof t.severity&&(l=t.severity,i.includes(l))?t.severity:void 0,a="string"==typeof t.repo?t.repo:void 0,c="number"==typeof t.cvss_score&&t.cvss_score>=0&&t.cvss_score<=10?t.cvss_score:void 0,u="string"==typeof t.description?t.description:void 0,d=Array.isArray(t.finding_ids)&&t.finding_ids.every(e=>"string"==typeof e)?t.finding_ids:void 0,p="number"==typeof t.affected_services_count&&t.affected_services_count>=0?t.affected_services_count:void 0,f="number"==typeof t.finding_count&&t.finding_count>=0?t.finding_count:void 0;if(void 0===r||void 0===o||void 0===a||void 0===c||void 0===u||void 0===d||void 0===p||void 0===f)return[null,"Cluster at index ".concat(e,": missing or invalid required fields (vulnerability_id, severity, repo, cvss_score, description, finding_ids, affected_services_count, finding_count).")];s.push({vulnerability_id:r,severity:o,repo:a,file_path:"string"==typeof t.file_path?t.file_path:void 0,dependency:"string"==typeof t.dependency?t.dependency:void 0,cvss_score:c,description:u,finding_ids:d,affected_services_count:p,finding_count:f})}return[s,null]}},9579:function(e,t,n){"use strict";n.d(t,{Zf:function(){return i},ds:function(){return o},sg:function(){return s},w:function(){return r}});let r="helion_reasoning_response";function i(e){if(null===e||"string"!=typeof e||0===e.length||e.length>5e5)return null;try{let t=JSON.parse(e);if(null===t||"object"!=typeof t||"string"!=typeof t.summary||!Array.isArray(t.cluster_notes))return null;let n=[];for(let e of t.cluster_notes){if(null===e||"object"!=typeof e||"string"!=typeof e.vulnerability_id||0===e.vulnerability_id.length||"string"!=typeof e.priority||0===e.priority.length||"string"!=typeof e.reasoning)return null;let t=e.assigned_tier;if(null!=t&&![1,2,3].includes(Number(t)))return null;let r=e.override_applied;if(null!=r&&"string"!=typeof r)return null;n.push({vulnerability_id:e.vulnerability_id,priority:e.priority,reasoning:e.reasoning,assigned_tier:null==t?void 0:Number(t),override_applied:null==r?null:r})}return{summary:t.summary,cluster_notes:n}}catch(e){return null}}function o(e){if("undefined"!=typeof sessionStorage)try{let t=JSON.stringify(e);if(t.length>5e5)return;sessionStorage.setItem(r,t)}catch(e){}}function s(){if("undefined"!=typeof sessionStorage)try{sessionStorage.removeItem(r)}catch(e){}}},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return i.a}});var r=n(2972),i=n.n(r)},257:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?a=r.concat(a):u=-1,a.length&&p())}function p(){if(!c){var e=l(d);c=!0;for(var t=a.length;t;){for(r=a,a=[];++u<t;)r&&r[u].run();u=-1,t=a.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function y(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new f(e,t)),1!==a.length||c||l(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}},s=!0;try{t[e](o,o.exports,r),s=!1}finally{s&&delete n[e]}return o.exports}r.ab="//";var i=r(229);e.exports=i}()}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=3572)}),_N_E=e.O()}]);