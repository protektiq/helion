"""Pydantic schemas for exploitability reasoning: request inputs and structured LLM output."""

from typing import Literal

from pydantic import BaseModel, Field

# Same vocabulary as existing severity/priority for deterministic downstream logic.
AdjustedRiskTier = Literal["critical", "high", "medium", "low", "info"]

ADJUSTED_RISK_TIER_VALUES: frozenset[str] = frozenset(
    {"critical", "high", "medium", "low", "info"}
)


class ExploitabilityOutput(BaseModel):
    """Structured output from exploitability reasoning: adjusted risk and recommended action."""

    adjusted_risk_tier: AdjustedRiskTier = Field(
        ...,
        description="Risk tier after considering exploitability and context.",
    )
    reasoning: str = Field(
        ...,
        min_length=1,
        max_length=500,
        description="1-3 sentences explaining the adjusted tier.",
    )
    recommended_action: str = Field(
        ...,
        min_length=1,
        max_length=300,
        description="One concrete action (e.g. patch, isolate, accept risk).",
    )


class ExploitabilityRequest(BaseModel):
    """Request body for POST /api/v1/exploitability."""

    vulnerability_summary: str = Field(
        ...,
        min_length=1,
        max_length=2000,
        description="Short summary or description of the vulnerability.",
    )
    cvss_score: float = Field(
        ...,
        ge=0,
        le=10,
        description="CVSS score in range 0.0â€“10.0.",
    )
    repo_context: str = Field(
        default="",
        max_length=500,
        description="Repository or service context (e.g. name, path, role).",
    )
    dependency_type: str = Field(
        default="",
        max_length=100,
        description="Type of dependency if applicable (e.g. direct, transitive, dev, n/a).",
    )
    exposure_flags: str = Field(
        default="",
        max_length=300,
        description="Exposure context (e.g. internet-facing, no-auth, internal-only).",
    )
